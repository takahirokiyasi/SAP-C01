# IPv6対応
EC2インスタンスがIPv6を介してインターネットと通信できるようにするには、VPCで次の設定を行う必要があります。
1. IPv6 CIDR ブロックと 1 つのパブリックサブネットを持つデフォルトでない VPC を作成します。サブネットを使うと、インスタンスをセキュリティや運用上の必要に応じてグループ化することができます。パブリックサブネットとは、インターネットゲートウェイを通してインターネットにアクセスするサブネットです。その際には、/16 の IPv4 CIDR ブロックを持つ VPC を作成し、/56 の IPv6 CIDR ブロックを VPC と関連付けます。IPv6 CIDR ブロックのサイズ (/56) は固定されており、IPv6 アドレスの範囲は、Amazon の IPv6 アドレスのプールから自動的に割り当てられます (独自の IPv6 アドレス範囲を指定することはできません)。 
1. 特定のポートのみからトラフィックを許可するセキュリティグループをインスタンスに作成します。 
1. サブネット内に Amazon EC2 インスタンスを起動し、起動時に IPv6 アドレスをインスタンスに関連付けます。IPv6 アドレスはグローバルに一意であり、インスタンスがインターネットと通信できるようにします。
1. VPC の IPv6 CIDR ブロックをリクエストできます。このオプションを選択すると、IPV6 CIDR ブロックをアドバタイズする場所であるネットワーク境界グループを設定できます。ネットワーク境界グループを設定すると、CiDR ブロックがこのグループに制限されます。 

## ルーティング
プライベートサブネットの場合、サブネットからEgress-onlyインターネットゲートウェイにインターネット経由の IPv6 トラフィックをすべてルーティングするルートを作成  
パブリックサブネットの場合、サブネットからインターネットゲートウェイに IPv6 トラフィックをすべてルーティングするルートを作成
## Security Group and ACL
IPv6アドレスのルールを含めて、セキュリティグループルールを更新する、これにより、IPv6トラフィックはインスタンスに出入りできるようになる。カスタムネットワークACLルールを作成して、サブネットに出入りするトラフィックの流れを制御している場合は、ACLにもIPv6トラフィックのルールを含める必要がある。

## VPC サブネット
IPv6　CIDRをVPCとサブネットに紐付ける。

# オンプレミス環境で利用しているパブリックIPv4アドレス範囲をオンプレミスネットワークからVPCに移行する方法

# Cloud Frontを利用していてHttp 504 エラーが発生している場合
グローバルなコンテンツ配信処理のパフォーマンスが低下している。
## Lambda Edgeの使用
Lambda Edgeを使用して、Lambda関数でCloudFrontが配信するコンテンツをカスタマイズし、ユーザーに近いAWSロケーションで認証プロセスを実行できます。これによって、グローバルなユーザーに適した認証プロセスが実施できることでモバイルアプリケーションのログイン遅延に対応することができる
## Cloudfrontのセカンドオリジンを設定する
もう1つをプライマリオリジンに障害が発生したときにCloudFrontが自動的に切り替える2番目のオリジンとして2つのオリジンを持つオリジングループを作成することにより、オリジンフェールオーバーを設定できる。
これにより、不定期のHTTP 504エラーが軽減

※Route 53の位置情報ルーティングでは遅延は解消されない（コンテンツのローカライズに普通は使用）

# ドメインが追加されるたびに証明書を発行＆プロビジョニングする必要がないようにALBを設定するにはSNI（Server Name Indication）を使用する
ACMコンソールを使用してALBのドメインのすべてのSSL証明書を追加し、複数の証明書をロードバランサーの同じセキュアリスナーにバインドします。
ALBは、Server Name Indication（SNI）を使用して、各クライアントに最適なTLS証明書を自動的に選択します。

https://dev.classmethod.jp/articles/alb-support-sni/

# cloudfrontでThe request could not be satisfied.Bad Request.のエラー
- リクエストが HTTP を通じて開始されたが、CloudFront ディストリビューションは HTTPS のリクエストだけを許可するように設定されている。この場合は、ビューワーのプロトコルポリシーにおいて、[HTTP and HTTPS  または Redirect HTTP to HTTPSのいずれかを選択します。したがって、オプション２が正解となります。

- リクエストされた代替ドメイン名 (CNAME) が CloudFront ディストリビューションと関連付けられていない。この場合はloudFront ディストリビューションと関連付ける CNAME を入力します。
