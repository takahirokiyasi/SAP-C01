# S3
## タイプ
### Intelligent-Tiering
4 つのアクセス階層の間でオブジェクトを移動することで、自動的にコストを削減する唯一のクラウドストレージクラス

### S3低頻度アクセス (1ゾーン - IA)
1ゾーンなので可用性は低い
それほど通常のS3と料金が変わらない

### Glacier
アーカイブ用途のストレージクラス
データ取り出しは標準3〜5時間程度
迅速は１〜５分
大容量は５〜１２時間

#### 圧縮でさらにコストダウン
Glacierに保存するファイルは保存する前に圧縮しておくとさらにコストダウン。
DynamoDBに圧縮したファイル群のIDとファイル名の属性情報を紐付けておけばそこから参照できる

### Glacier Deep Archive
アーカイブ用途のストレージクラス
 - 一年のうち1,2回しかアクセスされないようなデータを対象にした最も低コストなストレージクラス
 - 最小保存期間は180日で、最低180日よりも前にオブジェクトを削除した場合、180日分課金される
 - 復元オプションの標準取り出しで`12時間以内`、一括取得で48時間以内待つ必要がある

### 低冗長化ストレージ（RRS）
それほど重要でないデータを保存

## バケットポリシー
デフォルトでは何も設定されていない

## クロスアカウントアクセス
S3 バケットに保存されているオブジェクトへのクロスアカウントアクセスを許可するには、以下のいずれかの方法を使用します。

1. リソースベースのポリシーとIAMポリシー
1. アクセスコントロールリスト (ACL)とIAMポリシー
1. クロスアカウントIAMロール(STSのAssumeRoleを使用)
複数のサービスでクロスアカウントアクセスするときはこれ
[S3でのクロスアカウントアクセス](https://aws.amazon.com/jp/premiumsupport/knowledge-center/cross-account-access-s3/)

## マルチパートアップロードAPI
マルチパートアップロードAPIを使用すると、大容量オブジェクトをいくつかに分けてアップロードできるようになります。スループットの向上を図れるし、直接S3にアップロードできるのでコストが安い

## リクエスタ支払い
バケットへのリクエスト及び、データのダウンロードにかかるコストをリクエスタが支払うように変更することができる。

## VPCエンドポイント
S3バケットポリシーを使用してS3バケットにアクセスできるVPCとVPCエンドポイントを指定することが必要

## 暗号化
### デフォルト暗号化
バケットに保存される際にすべての新しいオブジェクトが暗号化される
オブジェクトは、Amazon S3 で管理されたキー (SSE-S3) または AWS Key Management Service (AWS KMS) に保存されたカスタマーマスターキー (CMK) のいずれかで、サーバー側の暗号化を使用して暗号化

#### サーバーサイド暗号化
Amazon S3 はオブジェクトをディスクに保存する前に暗号化し、オブジェクトをダウンロードするときに復号する

#### SSE-S3
- AmazonS3がデータ暗号化キーとマスター暗号化キーを管理
- キーに対する個別アクセス制限は不可、実質的なアクセス制限は署名バージョン4による当該AWSアカウントID以外の拒否のみとなる
- Advanced Encryption Standard (AES-256)で暗号化します。
- 監査証跡(CloudTrail)には残らない
- 無料

#### SSE-KMS
- AWSマネージド型キーまたは、カスタマー管理型のキーがありKMSでキーを管理
- キーポリシーでCMK(カスタマーマスターキー)への個別のアクセス制御ができる
- KMSに対するAPIコールに当たるため、監査証跡(CloudTrail)を残すことが可能
- 暗号化キーの作成および管理ができる
- 追加料金発生

##### KMSで暗号化を実施したバケットにオプジェクトをアップロードする場合
AWS KMSによる暗号化を実施したS3バケットにオブジェクトをアップロードするには、x-amz-server-side-encryptionヘッダーにaws：kmsの値を含むリクエストを送信する必要がある

### SSE-C
ユーザーが暗号化キーを管理
Amazon S3はSSE-Cの使用時にHTTP経由で行われたリクエストを拒否します。Amazon S3 REST API呼び出しの場合、次の3つのHTTPリクエストヘッダーを全て含める必要があります。

x-amz-server-side-encryption-customer-algorithm
x-amz-server-side-encryption-customer-key
x-amz-server-side-encryption-customer-key-MD5 

## バージョン管理
S3バージョン管理を有効にすると、既存のファイルはすべて、バージョンIDがNULLになる。
バージョン管理後に追加されたオブジェクトの最初のバージョンIDは1つ目のID（IDは一意のランダム値）

## S3 Select
クエリ処理を行うことで、オブジェクトデータの条件付きで検索・抽出することはできますが、大量データの検索機能としては不十分

## S3 イベント
特定のイベントが発生したときに、SNSやSQS,Lambdaを発火することができる
- 新しいオブジェクトの作成イベント
- オブジェクト作成イベント
- オブジェクト復元イベント
- 低冗長化ストレージ消失イベント
- レプリケーションイベント

## S3 Sync
aws cliのコマンドでローカルからファイルをS3にアップロードすることができる

## エンティティタグ (ETag)
オブジェクトのハッシュでファイルの整合性の検証に使用する

## S3 Transfer Acceleration
海外リージョン等の送信元から遠く離れたS3へのデータ転送を最適化する機能
CloudFrontのエッジロケーションを利用して最短距離でデータをS3に転送できる。

## Amazon S3 Batch Operations（バッチオペレーション）
Amazon S3のバケットに保存されているオブジェクトに対して一括でAPIを実行できる機能
オブジェクトのコピー・タグ付け・アクセスコントロールリストの設定
Glacierからのオブジェクトの復元・Lambda関数の呼び出しなどが可能

## ACL（アクセスコントロールリスト）によるアクセス管理
バケット（BucketACL）もしくはオブジェクト（ObjectACL）単位で設定することができる。
AWSアカウントに対してアクセス許可が設定できる。
またパブリックアクセスの制御ができる

## レプリケーション
### クロスリージョンレプリケーション
他のリージョンにレプリケーションしておくことでDRの時やグローバルで共通のファイルがあるときなどに役立つ
非同期で数時間でレプリケートされる。

# storage gateway
オンプレミスからAWS上のストレージへのアクセスを提供するもの。
オンプレミスサーバーからNFSインターフェイス経由でAWS上のS3オブジェクトに接続したり、オンプレミスにあるデータをS3上にアップロードすることができる。
storage gateway用の仮装マシンやストレージを用意する必要がある。

## storage gatewayの種類
### ファイルゲートウェイ
`S3`への`NFSやSMB`などのプロトコルによるインターフェイスを提供する。
オンプレミスのサーバーから直接S3のファイルにアクセスできる。
### ボリュームゲートウェイ
`S3`及び`EBS snapshots`をバックエンドとしたブロックストレージ
`iSCSIブロックインターフェイス`
#### Gateway-stored-volumes（保存型ボリュームゲートウェイ）
オンプレミスのデータのスナップショットを非同期にS3にバックアップする。データセット自体はオンプレ側にあるので、データセット全体への低レイテンシーアクセスが必要な場合はこれ
#### Gateway-cached-volumes（キャッシュ型ボリュームゲートウェイ）
データセット全体をS3に保存し、頻繁にアクセスするデータサブセットのコピーをオンプレミス側に保存する。オンプレミスのストレージの拡張コストを抑えることができる。
### テープゲートウェイ
`iSCSI仮想テープライブラリ（VTL）`インターフェイス
`S3`と`Glacier`にデータを保管する
物理テープライブラリの代替として利用する。

# AWS Snow
## AWS Snowcone
AWS Snowの中で最小のエッジコンピューティング、エッジストレージ、データ転送デバイス
8TB
## Snow Ball
### Snowball Edge Storage Optimized
vCPU40個分のコンピューティング能力があり、ローカルストレージや大規模データ転送に最適
大規模なデータ移行と容量指向のワークロードに適している多くのストレージを備えた
80TB
### Snowball Edge Compute Optimized
り高いパフォーマンスのワークロードに適している多くのコンピューティング機能を備えた
42TB
## AWS Snowmobile
最大100 PBのデータを長さ14mの丈夫な輸送コンテナで転送する

# EFS
EFSは、EC2とオンプレミス環境にマウントできるエラスティックファイルストレージです。 

EC2から`NFS`を使ってネットワーク経由でファイル単位でアクセス(WindowsのSMBはサポートしていない　EBSはブロック単位でアクセス)

Amazon EFS を使用すると、ストレージ容量は弾力的で、ファイルの追加や削除に応じて自動的に拡張および縮小されるため、アプリケーションは必要なときに必要なストレージを確保できます。
強い整合性がある。

## オンプレミスでのEFSの使用
オンプレミスからEFSファイルシステムにアクセスするには、オンプレミスのデータセンターと Amazon VPC が `AWS Direct Connect`または`AWS VPN`で接続されている必要があります。
NFSv4.1 プロトコルを介し、ファイルシステムのマウント用の標準の Linux mount コマンドを使用して、オンプレミスの Linux サーバーに EFS ファイルシステムをマウントします。 

## EC2での使用設定方法
Amazon EFS ファイルシステムを作成するには、create file systemを押し、EFSを利用するVPCを指定、
マウントターゲットを作成するAZとサブネットとセキュリティグループを指定する

コンソールまたは実行コードによって、EFSファイルシステムIDをEFS APIから取得して、EC2インスタンスからのアクセスの際に設定することが求められます。
EFSファイルシステムIDを利用してEC2 インスタンスを起動し、EFS ファイルシステムをマウントします。 

## NFSの仕組み
Unix/Linuxでネットワーク経由でファイルシステムを共有するための標準的な仕組みとプロトコル
ストレージを利用するサーバー群にはリモートのファイルシステムを`マウント`し
ストレージを提供するサーバーではローカルのファイルシステムを公開する

## マウントターゲット
VPC内の各AZにあるマウントターゲットがNFSの接続先になる
各EC2インスタンスから同じAZに作成されているマウントターゲットに接続
各マウントターゲットのDNS名とIPアドレスは固定

### マウントターゲットのアクセス制限
セキュリティグループ・サブネット内のリソースなのでNACLで制限することが可能

## マウントヘルパー
amazon-efs-utilsに含まれる機能
EC2などからEFSを使用するためのNFSクライアントとして利用してデイレクトりをマウントするためのもの
TSLで暗号化できたりするオプションがある　「-o tsl」
推奨オプションを勝手に設定してくれる

マウントヘルパーユーティリティであるamazon-efs-utils パッケージは、Amazon EFS ツールのOSS。
amazon-efs-utils パッケージは、Amazon Linux パッケージリポジトリで利用でき、他の Linux ディストリビューションのパッケージをビルドおよびインストールできます。

## パフォーマンスモード
### 汎用
デフォルト
低レイテンシー
### 最大I／O
大規模データを他使う並列アプリケーションで使用
無制限にスケールアウト
大規模な場合のみこっち

## スループットモード
### バーストモード
スタンダードストレージクラスのファイルシステムのサイズが大きくなるにつれて上昇
### プロビジョニングモード
保存されたデータ量とは別に、ファイルシステムのスループット (MiB/秒) を簡単にプロビジョニングできてスループットを引き上げることが可能

## EFS File Sync
既存のNFSサーバーからEFSに移行するときに使う
File Sync エージェントをがジョブを実行してくれる　暗号化通信で転送
並列で転送してくれるので5倍ほど早い

## メトリクス
### PercentIOLimit
汎用モードでIO限界にどの程度達しているのか知ることができる
100%に届いていたら汎用モードからMaxI／Oモードにする必要あり。

## 料金
ファイルストレージ容量による課金のみ


# Amazon FSx for Windows ファイルサーバー
Amazon FSx for Windows ファイルサーバーは、業界標準のサーバーメッセージブロック (SMB) プロトコルを介してアクセスできる、信頼性が高くスケーラブルな完全マネージド型のファイルストレージを提供。
EFSでは提供されていないSMBのプロトコルを使用することができる。
Windows Server 上に構築され、ユーザークォータ、エンドユーザーファイルの復元、Microsoft Active Directory (AD) 統合などの幅広い管理機能を提供。