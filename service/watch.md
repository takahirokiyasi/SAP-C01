# AWS Config
イベントの記録ではなく、選択されたAWSリソース（EC2サーバなど）の構成情報の記録や監視ができるサービス。
システム構成図を自動で作ってくれるイメージ。構成変更を何に対していつ何をしたか自動で記録してくれ確認できる
CloudTrailと連携してるので誰が構成変更のイベント起こしたのか見れる。

管理できるAWSリソースはセキュリティグループ・S3バケット・EC2インスタンス・Lambda・WAF・ELB・VPCなど60のリソースに対応

以下のことができる。
- AWS リソースの設定が最適な設定であるかどうかを評価する。（リソースの管理）
- AWS アカウントに関連付けられているサポート対象リソースの現在の設定のスナップショットを取得する。
- アカウント内にある 1 つ以上のリソースの設定を取得する。
- 1 つ以上のリソースの設定履歴を取得する。
- SQLクエリで構成情報を検索できる
- リソースが作成、変更、または削除されるたびに通知を受け取る。（設定変更の管理とトラブルシューティング・監査・コンプライアンス）
- リソース間の関係も見れる(特定のセキュリティグループを使用するすべてのリソースを確認する場合など)。（セキュリティ分析）
- すでに削除したEC2の設定情報も確認できる

SSMイベントリで収集した情報もConfigで記録してる
CloudFrontなどグローバルサービスはバージニア北部でサポート
保存先のS3バケットは特定の人しかアクセスできず、改竄ができない場所へ保存すること

## Configの各機能
### ストリーム
リソースが作成・変更・削除される度に作成され、構成ストリームに追加される
### ヒストリー
リソースの設定履歴を保存しておける
### スナップショット
ある時点でのリソース構成情報を保存できる

## Config Rules
構成の評価する機能
ルールに違反した構成変更が行われた場合に管理者に通知することができ、
タグが付与されていないリソースが作成されていないか監視することができたりする。

マネージドルールとカスタムルールがある。
カスタムルールはLambda関数でをベースにルールを作成し、ルールにLambdaのARNを紐づけ、ルールの評価のタイミングの設定（トリガタイプ）を行う（AWS Config　Rule Development Kitというカスタムルールを作成するツールがある）

ルールの評価のタイミングは設定変更時と定期実行がある

例）
- 全てのEBSボリュームが暗号化されているか encrypted-volumes
- EC2にタグが付与されているかとか required-tags
- EC2はSystemManagerで管理されているどうか　ec2-instance-managed-by-ssm
- 実行中のインスタンスで使用されているAMIは社内で承認ずみのものか　approved-amis-by-id
- VPC Flow Logs（パケットログ取得）が有効になっているか　vpc-flow-logs-enabled
- S3バケットでパブリック読み込みが許可されていないことを確認　s3-bucket-public-read-prohibited
- 有効なアクセスキーが、指定日以内にローテーションされているかどうか　access-keys-rotated

### 修正アクション
コンプライアンス違反のリソースに対してAWS System Manager Automationドキュメントを利用したカスタムの修正アクションを設定できる。
またCloud Watch Eventsでコンプライアンス違反の検出イベントを発火し、Lambdaを実行してより細かい修正アクションを行うことも可能
Slackへの通知とかもできる

### AWS Config Rules Repository
コミュニティベースでカスタマイズされたAWS Config RulesがGitHub上で公開されている

例）
- Lambda関数がVPCに紐づいているか
- ALBがHTTPSリダイレクト有効か

## マルチリージョン・マルチアカウント
AWS Configのマルチアカウント、マルチリージョンのデータ集約により、複数のアカウントおよびリージョンからのAWS Configデータを単一のアカウントに集約できる。
マルチアカウント、マルチリージョンのデータ集約は、中央のIT管理者が企業内の複数のAWSアカウントのコンプライアンスを監視するのに役立つ

# AWS X-Ray
本番環境や分散アプリケーション (マイクロサービスアーキテクチャを使用して構築されたアプリケーションなど) を分析およびデバッグできる。

# CloudWatch
## CloudWatch Logs
### CloudWatch Logs Insights
クラウドスケールで動作するよう設計され、セットアップやメンテナンスが不要なフルマネージドのサービス。
大量のログを数秒で走査し、インタラクティブなクエリの実行と可視化を提供する
フローログではトラフィックのログしか確認できるが、オペレーティングシステムのログファイルは収集することはできない

# Cloud Watch エージェント
EC2のメトリクスとログを収集できる。
オンプレミスサーバーからもメトリクスを収集できる。（Linux Widows）
CloudWatch エージェントによって収集されたログは、以前の CloudWatch Logs エージェントによって収集されたログと同様に、処理されて Amazon CloudWatch Logs に格納される

## ダッシュボード
メトリクスのところで特定のリージョンを選択しながらグラフを作りダッシュボードを作ることができる。（複数リージョンのメトリクスを同一ダッシュボードに表示可能）

## EC2Rescue for Windows Server 
Amazon EC2 Windows Server インスタンス上で動作し、潜在的な問題の診断とトラブルシューティングを行うことができる使いやすいツールです。ログファイルを収集して問題を解決するだけでなく、問題がありそうな部分をプロアクティブに検索することができます。他のインスタンスから Amazon EBS ルートボリュームを調べて、そのボリュームを使用する Windows Server インスタンスをトラブルシューティングするために必要なログを収集することもできます。したがって、EC2Rescueツールを使用して分析のためにオペレーティングシステムのログファイルを収集することで原因を特定します。

# PutMetricData API コール
1秒あたり1000レコードを収集しています。 そして、これをカスタム名前空間を使用してCloudWatchにこれらのデータを送信したい
PutMetricData API コールを使うことによって集約したデータを送ることができる
大量のメトリクスデータを効率よくインジェストしながら、API コール数が減ることでコストを削減することもできる
