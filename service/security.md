# AWS Systems Manager（SSM）

a. マネージドインスタンス：SSM管理下のインスタンス
マネージドインスタンスにする方法
1. SSM Agentの導入
1. SSM APIへの経路確保
1. IAMロールの付与（EC2にSSMへのアクセスを許可　 AmazonSSMMAnagedInstanceCore）
→クイックセットアップ（高速セットアップ）でこれらを素早く設定できる
＋新規インスタンスも自動でマネージドインスタンスにすることが可能
＋2週間毎のSSM Agentの自動更新　３０分おきのイベントリ収集してくれる

オンプレの場合はTLS証明書をイントール＋SSMのアクティベーションコードの生成・設定が必要

b. リソースグループ（マネージドインスタンスのグループ化）
タグベースorCloudFormationで設定可能
タグエディター使えば便利

c. リソースの把握
SSM Explorer
SSM OpsCenter
SSM コンプライアンス

d.　インスタンスの中身を把握
SSM イベントリ

e. SSMで定型運用の実施
SSMドキュメントという運用処理を定義して実行（事前定義ドキュメントがあるので利用可能　JSON YAML）
1. Document Builerで自動化ドキュメント（Automation Playbook）を作成
1. 定義の実行　Run Commandでコマンドドキュメントを実行しShellScript等を実行 or　自動化（Automation）で自動化ドキュメントを実行しAWSサービスを操作
1. 定期実行したい場合はステートマネージャー（軽めの処理）orメンテナンスウィンドウ（重い処理）を使用

f.非定型な運用処理も
定型の処理ではなくサーバーの中でインタラクティブな作業をする時に便利な機能
SSM セッションマネージャーでインバウンドポートをセキュリティグループで開かなくてもSSH接続やRDPが可能になる

g. アプリケーションの設定管理も
パラメータストアで機密情報を管理
AppConfigでアプリケーションの設定だけをデプロイ（EC2、コンテナ、Lambdaにアプリケーションの再起動なしに設定を展開可能）

## SSM Agent
SSM Agentは、EC2 や オンプレミスサーバ にインストールすることのできるソフトウェアで、System Managerはこのソフトウェアを介して、これらのリソースの更新や管理、設定を行うことができる。
SSM AgentがSSM APIと連携し各種操作・コントロールを行う（AgentがSSM APIに対してポーリングで一方通行でOK）

SSM　APIへの経路を確保するには
パブリックサブネットにありインターネット通信可能な状態にする
パブリックサブネットではVPCエンドポイントを使ってSSM APIへ接続できるようにする
オンプレミスの場合はDirect ConnectかVPN

EC2上で提供されているWindows ServerやAmazon Linux、 Ubuntu ServerのAMIには、あらかじめSSM Agentがインストールされている。Systems Manager エンドポイントとの間でHTTPS通信を確立する必要があり、HTTP Proxy経由で通信する設定にすることもできる。なお、このエージェントの動作ログは以下の場所に格納されている。

/var/log/amazon/ssm/amazon-ssm-agent.log
/var/log/amazon/ssm/errors.log

SSM Agentの実行にはroot権限が付与されていることから、このSSM Agentを用いて SendCommand や StartSession コマンドを行うことが可能なAWS上のIAM ユーザ等の管理や権限付与には注意する必要がある。
SSM Agentをリリースのたびに更新し最新のバージョンを保持するためには、マネージメントコンソール上のマネージメントインスタンスのページから、Agent auto update (エージェントの自動更新)を選択する。

## SSM Explorer
インスタンス数やAMI別のインスタンス数などのリソース情報をレポートするダッシュボードサービス
クロスアカウント・クロスリージョンでリソースの状況を可視化できる。
オペレーションデータをOpsDataと呼ぶ
EC2情報とパッチコンプライアンス

## SSM OpsCenter
運用タスクリスト（OpsItems）を表示、調査、解決できるダッシュボード

## SSM コンプライアンス
コンプライアンスに準拠していないリソースを特定できるダッシュボード
デフォルトではパッチ適用情報・ステートマネージャの関連付け状況がコンプライアンスとして定義済み

## SSM インベントリ
EC2からSSM　インベントリでS3にデータを収集してAthena＋QuickSightを用いて分析・可視化できる
Configに構成情報を送信し、イベントリ情報の変更追跡が可能
マルチリージョン・マルチアカウントで分析可能
- OS上のアプリケーション一覧
- Windowsアップデート
- インスタンスの詳細（OS名　OSバージョン　最終起動）
- ファイル（実行中のプログラムも）
- AWSコンポーネント（EC2ドライバ）
などの情報を収集できる。

## SSM ドキュメント
オートメーション（自動化）
stepでそれぞれの処理を定義する。
スクリプトを実行する機能などがある。

## ステートマネージャー
サーバー群に対して`定期的`に処理を行うためのフレームワーク(軽めの処理)
サーバーの状態を確認・是正するための定期的な処理に向く（イベントリ収集・SSM　Agentの定期更新）
処理が失敗すると、コンプライアンスにレポートされる。

SSMの機能のRun Command と　自動化（Automation）を実行することができる

- 起動時に特定のソフトウェアを使用してインスタンスをブートストラップする
- 定義済みのスケジュールに従ってエージェント (SSM エージェント など) をダウンロードして更新する
- ネットワーク設定を構成する
- インスタンスを Windowsドメインに結合する (Windows Server インスタンスのみ)。
- ライフサイクルを通じてソフトウェアの更新でインスタンスをパッチする
- ライフサイクルを通じて Linux および Windows マネージドインスタンスでスクリプトを実行する

## SSM　メンテナンスウィンドウ
サーバー群に対して`定期的`に処理を行うためのフレームワーク（重めの処理）
サービス停止を伴うような比較的重たい処理に向く（OSパッチ適用、バックアップ取得）
ステートマネージャーと比べ精緻な制御が可能

Run　Commandと自動化（Automation）に加えてLambda,Step Functionも実行可能

メンテナンスウィンドウではS3バケット、SQSキュー、AWS KMSキーなど、多くのAWSリソースタイプでアクションをスケジュールすることもできます。

## Systems Manager Automation （自動化）
Amazon EC2 インスタンスおよび他の AWS リソースの一般的なメンテナンスとデプロイのタスクを簡素化します。
自動化ワークフローを構築して、インスタンスおよび AWS リソースを設定し、管理します。独自のカスタムワークフローを作成するか、または AWSによって管理された定義済みのワークフローを使用します。

### 通知の受信
Amazon CloudWatch Eventsを使用して自動化タスクおよびワークフローに関する通知を受信

## AWS Systems Manager Patch Manager
パッチルールの準拠の確認・インスタンスへのパッチ適用が可能
Patch Manager を使用して、オペレーティングシステムとアプリケーションの両方にパッチを適用することができる。
オペレーティングシステムのタイプ別に、Amazon EC2 インスタンスまたはオンプレミスサーバー、および仮想マシン (VM) にパッチを適用できる。

scanのみとScan＋Installが選択できる

### OS環境ごとのパッチ適用
パッチベースラインをOSの種類毎に作成し、パッチの適用ルールを定義しておく（OS＋用途別でも定義可能）
パッチベースラインはPatch Groupタグで紐付けることができる。

OS環境に応じたEC2インスタンスのタグ設定を実施し、AWS Systems Manager Patch Manager を利用してパッチベースラインを各環境に対して作成し、EC2インスタンスをパッチグループで分類して、パッチベースラインを適用することで、要件に合致したバッチ適用プロセスを整備することができる

## AWS SSM ディストリビューター
独自のソフトウェアパッケージの配布・インストールが可能
Linux/Windowsなど複数のプラットフォームに対応
AWS定義のソフトウェアパッケージも配布可能（CloudWatchAgent・EFSUtilsなど）

## SSM セッションマネージャー
シェルアクセスしてEC2をセットアップする時にインバウンドポートをセキュリティグループで開かなくてもシェルアクセスが可能になる
プライベートサブネットのインスタンスにもアクセス可能で踏み台サーバーが不要
- SSHがなくてもサーバ作業が可能になる
  EC2鍵管理をなくし、およびSSHポート開放も不要になる
- AWS ACCESS KEYの管理を減らせる可能性がある
  ローカルPCにAWS ACCESS KEYを置いてAWS作業を行っている場合、AWS ACCESS KEY自体を不要にできる。
  例えば、EC2にIAMロールを付与すれば、AWS ACCESS KEYがなくてもIAMロール権限でAWS CLIやSDKを実行できるが、セッションマネージャからEC2にログインしてAWS作業を行うようにすれば、AWS ACCESS KEYの管理が不要になる
- コマンドログがS3に格納されるので、監査の要件も満たせる

アクセス制御はIAMユーザーに対してIAMポリシーで指定する。

接続手段は２つ
1. SSM Agent経由で直接アクセス
1. SSM Agentでトンネルを作成してRDPでアクセス（接続履歴は残るが、操作履歴が残らない）
1. SSM Agentでトンネルを作成してSSHでアクセス（現在のクライアント運用そのままにSSH接続で操作できるしセキュリティグループは閉じておくことができる）


## AWS Systems Manager パラメータストア(SSM)
構成データ管理のための安全で階層的なストレージを提供し秘密の管理を行います。パスワード、データベース文字列、マシンイメージ(AMI)ID、およびパラメータ値としてのライセンスコードなどのデータを保管できます。  
プレーンテキストまたは暗号化データの形式で保管でき、参照できます。  
Systems Manager パラメータをスクリプト、コマンド、 SSM ドキュメント、構成、および自動化ワークフローを、 パラメーターの作成時に指定します。

### パラメータストアとSecret managerの違い
設定とシークレットにひとつのストアが欲しい場合、パラメータストア
ライフサイクル管理を備えたシークレット専用のストアが欲しい場合、Secret Manager
パラメータストアは無料、Secret Managerは有料

## SSM AppConfig
アプリケーションの設定だけをデプロイ（EC2、コンテナ、Lambdaにアプリケーションの再起動なしに設定を展開可能）
開発や本番など環境毎に異なる設定情報をデプロイできる。
設定情報はパラメータストアもしくはSSMドキュメントとして保管
展開前にバリデーションも実施できる
デプロイ戦略を定義でき、カナリアリリースも可能

キャンペーンなどでアプリケーションをデプロイするのではなく何らかの設定値を変更するだけの場合にAppConfigを使うと便利

# セキュリティグループとネットワーク ACL (NACL) の比較
次の表は、セキュリティグループとネットワーク ACL の基本的な違いをまとめたものです。

| セキュリティグループ | ネットワーク ACL |
|-|-|
|インスタンスレベルで動作します。| サブネットレベルで動作します。|
|ルールの許可のみがサポートされます|ルールの許可と拒否がサポートされます|
|ステートフル: ルールに関係なく、返されたトラフィックが自動的に許可されます | ステートレス: 返されたトラフィックがルールによって明示的に許可されます|
|トラフィックを許可するかどうかを決める前に、すべてのルールを評価します|トラフィックを許可するかどうかを決定する際に、最も低い番号のルールから順にルールを処理します。|
|インスタンスの起動時に誰かがセキュリティグループを指定した場合、または後でセキュリティグループをインスタンスに関連付けた場合にのみ、インスタンスに適用されます。|関連付けられているサブネット内のすべてのインスタンスに自動的に適用されます（そのため、セキュリティグループのルールの許容範囲が広すぎる場合は、保護レイヤーを追加する必要があります）。|


# IAM
## タグでの運用制限
IAMグループとIAMポリシーを使って
特定のタグが付与されたインスタンスのみ操作できるなどの運用を実現することができる。

## 外部IDの信頼条件設定
サードパーティのサービスにリソースのアクセス許可をする場合はIAMロールについているIAMポリシーに外部IDを信頼条件として設定し、外部ID＋ロールのARNでAssumeRoleすることで安全に外部アクセスさせることができる。

## リソースベースのIAMポリシーの付与によるクロスアカウントアクセス
ロールによってアクセス許可が付与される場合は元から与えられていたアクセス許可を放棄しないといけないが（クロスアカウントアクセスの場合ロールの切り替えをしないといけない）
リソースベースのポリシーで許可した場合は元のアクセス許可は保持されるというメリットがある

## IAMロールによるクロスアカウントアクセス
あるアカウントのユーザーを別のアカウントのIAMロールに紐づける機能。
例えば開発アカウントを使って、本番環境のS3データを更新するようなケースで利用
AssumeRoleを使う。

## Switch Role
IAMユーザーからクロスアカウントアクセス用IAMロールに切替ができる
Switch Roleを活用することにより各アカウントのIAMユーザーとしてログインしなおすことなしにセキュアに管理コンソールを切り替え可能

## IAM ポリシー
### 信頼ポリシー
IAMロールを引き受けると信頼するプリンシパルを定義するJSONポリシードキュメント。ロール信頼ポリシーは、IAMのロールにアタッチされる必須のリソースベースのポリシーです。信頼ポリシーで指定できるプリンシパルには、ユーザー、ロール、アカウント、およびサービスが含まれます。 

# STS(Security Token Service)
IAMの一機能  
一時的セキュリティ認証情報を持つ、信頼されたユーザーを作成および提供することができる。
ユーザーにはロールが紐づいている
## ID フェデレーションでのSTSの使用
### ウェブIDフェデレーション
基本的にはAWS Cognitoを使うことで実現できるが、直接AssumeRoleWithWebIdentity APIを呼び出しても実現できる（Cognitoを使う時もAssumeRoleWithWebIdentity APIを叩いている Cognito推奨）
Google・Amazon・Facebook認証とかで使用する。

### エンタープライズIDフェデレーション
組織のネットワークのユーザーを認証し、ユーザーが AWS にアクセス可能にすることができる。
Microsoft Active Directory を活用できる。

#### カスタムフェデレーションブローカー
※社内でSAML 2.0をサポートしていない社内のID認証システムを使う場合（LDAP（Lightweight Directory Access Protocol）による認証など）
組織の認証システムを使用して AWS リソースへのアクセスを許可することができる。

1.AssumeRole
ユーザーを認証するためのカスタムIDブローカーを作成し。AssumeRoleを用いてAWSリソースへのアクセスに使用できる一時的なセキュリティ認証情報のセットを取得し、AWSリソースにアクセス。
これらの一時的な資格情報は、アクセスキーID、シークレットアクセスキー、およびセキュリティトークンで構成される。
通常、AssumeRoleはアカウント内またはクロスアカウントアクセスに使用します

端的に言うと、AssumeRoleはRoleArnを入力するとCredentialsを返すAPI

2.GetFederationToken
GetFederationTokenではフェデレーションユーザーの一連の一時的なセキュリティ資格情報（アクセスキーID、シークレットアクセスキー、およびセキュリティトークンで構成される）を返します。IAMユーザーの長期的なセキュリティ認証情報を使用してGetFederationTokenオペレーションを呼び出す必要があります。 その結果、この呼び出しにより、サーバーベースのアプリケーションにおいて、これらの資格情報を安全に保存することができます
AssumeRoleと違ってデフォルトの有効期限が大幅に長い（12時間）
既存の IAM ユーザーに一時的セキュリティ認証情報のセットが返ります。この API は、MFA が IAM ユーザーに対して有効なときに AWS リクエストを作成するなど、セキュリティを強化するために役立つ

#### SAML2.0を用いたフェデレーション
組織の認証システムとSAMLを使用して、AWSリソースへのアクセスを許可することができる。

AssumeRoleWithSAML

##### IAM ID プロバイダー
外部 ID プロバイダー (IdP) サービスとの連携を設定する場合、IAM IDプロバイダーを作成し、IdPとその設定について AWS に通知します。これにより、AWS アカウントと IdP の間の「信頼」が確立される。

コンソール・CLI・APIで作成可能

# AWS Resource Access Manager(AWS RAM)
所有する特定のAWSリソースを他のAWSアカウントと共有できます。AWS OrganizationsでTrusted Accessを有効にするにはAWS RAM CLIから、enable-sharing-with-aws-organizationsコマンドを使用します。

# ACM
リージョン単位で証明書を発行する
ACM以外にもSSL証明書をIAMに保存することもできるが非推奨

# AWS CloudHSM
AWS上に利用者専用のハードウェアがプロビジョニングされ、サーバーを含めて暗号化キーを利用者が管理することができる。
ハードウェアセキュリティモジュール (HSM) では、不正使用防止策の施されたハードウェアデバイス内での、安全なキー保管と暗号化操作が可能になる。HSM は暗号キーデータを安全に保存し、ハードウェアの暗号境界の外側からは見えないようにキーデータを使用できるよう設計されている。

## SSL/TLS オフロード(SSL アクセラレーション)
オフロードにより、ウェブサーバーの`プライベートキー`を HSM に保存することで、ウェブサーバーの計算の負担が軽減され、セキュリティが強化されます。

[仕組み](https://docs.aws.amazon.com/ja_jp/cloudhsm/latest/userguide/ssl-offload-overview.html)

# AWS Shield
## AWS Shield Standard
インフラストラクチャ (レイヤー 3 および 4) を標的とするすべての既知の攻撃を総合的に保護できる。
自動的に適用されていて追加料金なし
SYNフラッドやUDPリフレクション攻撃などの多くの一般的なDDoS攻撃を防ぐ

## AWS Shield Advanced
レイヤー7の攻撃も防ぐことができる（DDos）
Amazon CloudWatch でのほぼリアルタイムの通知と、AWS WAFとAWS Shieldマネジメントコンソールあるいは API での詳細な診断によって、DDoS 攻撃に対する完全な可視性を与えてくれる。
AWS WAF and AWS Shieldマネジメントコンソールから以前の攻撃の要約を表示することもできる。

## AWS WAF
## Web ACL
Webアクセス制御リスト(Web ACL)は、保護されたリソースが応答するWebリクエストに対してきめ細かい制御を提供します。保護できる Amazon CloudFront, Amazon API Gateway, Application Load Balancer, and AWS AppSync リソース。
- リクエストの IP アドレスの送信元
- リクエストの送信元の国
- リクエストの一部に含まれる文字列一致または正規表現（regex）一致
- リクエストの特定の部分のサイズ
- 悪意のある SQL コードまたはスクリプトの検出

# CloudHSM
クラウドベースのハードウェアセキュリティモジュール (HSM) 
クラウドで暗号化キーを簡単に生成して使用できるようになります。
CloudHSM で、FIPS 140-2のレベル3認証済みのHSMを使用して、暗号化キーを管理できる。

AWS CloudHSMを使用して、WebサーバーのSSL / TLS処理をオフロードできます。この処理にCloudHSMを使用すると、Webサーバーの負担が軽減され、Webサーバーの秘密キーをCloudHSMに保存することでセキュリティが強化されます。 SSLおよびTLSは、WebサーバーのIDを確認し、インターネット上で安全なHTTPS接続を確立するために使用される。

# AWS Organizations
## 新規AWSアカウントの作成
マスターアカウントからのみ組織のメンバーアカウントを作成できる。
メンバーアカウントに与えるIAMロール・メールアドレス・アカウント名・billingに対するアクセス権を設定する。

## SCP
制御できるのは各リソースに対しての権限の最大範囲（S3に対する読み取り・書き込み・管理全て）だけで、別にIAMグループ＋IAMロールとかでS3読み取りのみの制限を加える必要がある。
RootとOUとAWSアカウントに付与可能
Rootに付与した場合、全ての組織のアカウントにSCPを付与していることになる

実際のアクセス許可は付与できない。
IAMユーザーおよびロールに付与されるポリシーに対してガードレール的な役割や、制限を設定する

AWS OrganizationsのSCPは`サービスにリンクされたIAMロール`には影響しないようになっている。 そのため、サービスにリンクされたロールにより、他のAWSサービスの利用を継続することが可能。したがって、SCPを適用した後も、IAMロールによって新アカウントは実行が制限されているはずのECSの実行アクションを操作できる状態が継続することができる

### ブラックリスト方式
OU,AWSアカウントの両方でFullAWSAccess権限を持ちつつ不要な操作をOU側のブラックリストで拒否するパターン　
### ホワイトリスト
FullAWSAccessをデタッチして許可したい権限だけ許可する
OUに対してホワイトリストでSCPを設定することが多い。

## 統合請求
AWS Organizationsを利用して一括請求を設定すると、ボリュームディスカウントやリザーブドインスタンスの割引適用を登録されたメンバーアカウント全体で共有することができる
### リザーブドインスタンス
開発アカウントが購入した同じインスタンスタイプのリザーブドインスタンスを設置しているAZでインスタンスを起動している本番環境アカウントにおいて、統合請求による価格割引の恩恵を受けることができることになる（開発アカウントでインスタンスの使用なしの時）

## ログ取得
AWS Organizationsを利用してマスターアカウントのCloudTrailにおいて組織の証跡を有効化することで、全てのメンバーアカウントでのログ取得を可能にすることができます。それにより、各AWSアカウントに関連するログをプライマリアカウントの単一のS3バケットに配信する設定も可能

## メンバーアカウント削除する時のアクセス拒否への対処
メンバーアカウントをマスターアカウントとして削除しようとすると、「アクセスが拒否されました」というメッセージが表示される原因は次の２つです。

- メンバーアカウントでの請求を IAM ユーザーアクセスで有効にした後でのみ、メンバーアカウントを削除できます。
- アカウントがスタンドアロンアカウントとして動作するために必要な情報を持っている場合にのみ、組織からアカウントを削除できます。

AWS Organizations コンソール、API、AWS CLI コマンドを使用して組織内にアカウントを作成した場合、その情報が自動的に収集されるわけではありません。
スタンドアロンとして使用する各アカウントについて、まず AWS カスタマーアグリーメントに同意してサポートプランを選択し、必須の連絡先情報を入力および確認して、支払方法を入力する必要があります。

# CloudTrail
## S3バケット削除したユーザーの確認
S3バケット削除のリクエストはAWSアカウントから行われ、リソースはメインAWSアカウントの一部であるため、CloudTrailによってアカウントのログ記録を確認し、使用されているユーザートークンを照合することでユーザーを確認することができます。
また特定のアクティビティの確認のためには、メインAWSアカウントへの役割を引き受ける時点で、AWSアカウントがsharedEventIdおよびuserIdentity情報を持つエントリを作成している必要があります。
これを使用して、DeleteBucket APIを実行する必要がある実際のAWSユーザーを特定できます。

### sharedEventId
異なる AWS アカウントに送信される同じ AWS アクションから CloudTrail イベントを一意に識別するために CloudTrail によって生成された GUID。
### userIdentity
リクエストを行った IAM ID のタイプとどの認証情報が使用されたかに関する詳細が含まれる
userのArnやAccountIdなどが含まれている

## Cloud Watch Logsによるユーザーアクティビティの追跡
CloudWatch LogsイベントによってCloudTrail API呼び出しでトレースできます。これにより、ユーザーの不適切なリソース利用を監視し、問題を分析することで、余分なリソース利用に即時対応ができる仕組みを整備できる。

## CloudTrail Insight
ログの異常なアクティビティを検出する

# AWS Cognito
基本的に提供してるサービスのお客様向け
（当たり前だけどAWS SSOでAmazon Cognito ユーザープールをアイデンティティソースとしては利用出来ない　SSOは従業員に対してMicrosoft ADとか使ってシングルサインオンでAWSにアクセスできる機能）

## ユーザープール
`アプリへのアクセスに利用できるトークン（JWT）を発行・提供`
認証・認可を制御するためのメイン機能
Cognitoユーザーの管理・サインインサインアップ機能・外部IDプロバイダーやcognito発行のトークン管理などを行う。

Amazon Cognito のユーザディレクトリ
ユーザープールを使用すると、ユーザーは Amazon Cognito を通じてウェブまたはモバイルアプリにログインできる。(入力されたユーザーのメールアドレスやパスワードを検証・認証できる)
また、ユーザーは Google、Facebook、Amazon、Apple などのソーシャル ID プロバイダー、および SAML ベースの ID プロバイダー経由でユーザープールにサインインすることもできる。

リージョン毎にユーザープールを作成
APIGateway・Appsync・ALB(Cognito認証 実用性はない)で連携可能で認証できる

### グループ
IDプールと連携可能でユーザープールのグループでIDプールで与えるロールとか設定できたりする

### アプリクライアント
HostedUI・API呼び出し・OAuthなどでユーザープールにアクセスできる

## フェデレーティッドアイデンティティ(IDプール)
`AWSにアクセスできるクレデンシャルを提供`
ユーザープールのアカウントに対して、IAMロールの付与を行う機能（AWSへの一時的なクレデンシャルを発行）
S3へのアクセスをクライアントから直接できたりできる

## Cognito Sync
IDプールで管理されるユーザー単位に、デバイス間でアプリケーションデータを同期する機能
新規で開発する場合、AWS AppSyncというがあるので現在非推奨

# AWS SSO
従業員に対してMicrosoft ADとか使ってシングルサインオンでAWSにアクセスできるサービス
STSを使ってSSOを実現するのではなく、より簡単にSSOを実現する。導入に必要なタスクがより少なくなった

AWS SSO内にADをデフォルトで作れる（外部のADにも接続できる）
## Organizationsとの統合
- AWS Organizations マスターアカウントから、ユーザー毎のアクセス権限を⼀元管理
既存の社内認証情報を使用できる

## SAMLのサポート
SAMLが利用できるアプリケーションへのSSOアクセスをすることができる

# Directory Service
## Simple AD
比較的小規模かつ的コストのマネージド型ユーザーディレクトリが必要な場合に利用できる
AWS上に独立したドメインを作成し、Samba4プロトコルに対応したActive Directory互換のディレクトリとして利用できる。
## AD Connector
オンプレミス環境やAWS上にある既存のディレクトリサービスへの認証プロキシのような役割を果たす。
ユーザー情報を保持するわけではない。
AD Connectorを経由することで既存のディレクトリサービスを利用して認証処理を行うことが可能

## AWS Directory Service for Microsoft Active Directory(AWS Managed Microsoft AD)
オンプレミスのADと信頼関係を構築できる。
既存のADインフラストラクチャを使用してAD対応ワークロードをAWSクラウドに移行する場合は、AWS Managed Microsoft AD が適当。
AD 対応アプリケーションと AWS アプリケーションにユーザーはオンプレミス AD 認証情報でアクセスでき、そのためのユーザー、グループ、またはパスワードの同期が不要。
たとえば、ユーザーは既存の AD ユーザー名とパスワードを使用して、AWS マネジメントコンソールとAmazon WorkSpaces にサインインできます。また、SharePoint などの AD 対応アプリケーションに認証情報の再入力なしでアクセスできるようになる。
[AWS Managed Microsoft ADのユースケース](https://docs.aws.amazon.com/ja_jp/directoryservice/latest/admin-guide/ms_ad_use_cases.html)

# 認証・認可の基本知識
# 仕組み・機能
### SSO
1度のログインにより複数のサービスはアクセスすることができる機能  
[AWS 公式　シングルサインオンの運用](https://d1.awsstatic.com/webinars/jp/pdf/services/20200722_AWSBlackbelt_%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%B3%E3%81%AE%E8%A8%AD%E8%A8%88%E3%81%A8%E9%81%8B%E7%94%A8.pdf)
AWSマネジメントコンソールへのフェデレーションアクセスではなく、AWSへのAPIアクセスのフェデレーションを実装する場合は、SSOエンドポイントではなくSTSのAssumeRoleWithSAML

### IDフェデレーション
SSOを実現するための一つの手段、それぞれのID管理基盤はそのままに、ネットワークドメインをまたいで互いに“連携”させるもの（今までは社内などの単一ネットワークドメインのだけだった）

## プロトコル
OAuth・OpenID Connect・SAMLはSSOを実現するためのプロトコル

OAuthは認可（権限を与える）のプロトコル
OpenID ConnectやSAMLは認証（身元を明らかにする）のプロトコル

OpenID ConnectはOAuthの拡張規格のためSNSのOAuth認証と同時に利用され
SAMLはActive Directory Federation Services (ADFS) などに利用されている。

# KMS
https://dev.classmethod.jp/articles/10minutes-kms/

# Amazon Macie
`S3内`のデータを機械学習を使用してデータを自動的に特定および分類することで、`機密データ`を検出して保護するのに役立つフルマネージド型のサービス
住所や名前、クレジットカード情報を検出できる
Organizationでのマルチアカウントをサポート
