# EC2
## インスタンスタイプ
ネットワーク帯域はインスタンスタイプによって決まる
インスタンスタイプがIPv6に対応していない場合がある（M3など）

### 汎用
M4 M5
### メモリ最適化
R4 R5 X1e
大量のメモリ容量が必要なDBサーバー等に利用
### コンピューティング最適化
C4 C5
APサーバーや画像処理に使用
### ストレージ最適化
D2 H1 I3
高速なIPOSや、大容量ストレージ容量が必要なDBサーバー、Data Warehouse、ビッグデータ処理に利用
### グラフィカルインスタンス
G3 G2
NVIDIA Tesla M60 GPUにアクセス可能

### 追加機能
C5nなどインスタンス世代の番号の後にオプション表記があるものがある
- d：標準インスタンスに対して、内臓ストレージ(インスタンスストア)を内蔵
- n：標準インスタンスに対して、ネットワークを強化
- a：AMDのCPUを搭載

## Auto Scalingグループ
### CLIコマンド
terminate-instance-in-auto-scaling-group CLIコマンドにより、指定されたインスタンスを終了し、必要に応じて必要なグループサイズを調整します。この呼び出しは、インスタンスがただちに終了しないように、終了要求を行います。

このコマンドを実行する際は--should-decrement-desired-capacity または --no-should-decrement-desired-capacityを利用して、インスタンス数の調整オプションの設定が必要


## Auto Recovery
ネットワークやハードウェアの不具合によって発生したシステムステータスチェックの失敗をトリガーにしてEC2インスタンスを再起動することができる。

## インスタンスメタデータ
インスタンスのメタデータの中には、資格情報が入っており、ロールに添付されたポリシーで指定された権限が付与されている。

## プレイスメントグループ
プレイスメントグループの設定は先にプレイスメントグループを構成した上で、その中でインスタンスタイプとインスタンス数を決定することが必要
インスタンスタイプは同じものでないとだめ

### プレイスメントグループの追加
インスタンスタイプを統一し、追加に伴うインスタンス総数を再設定して追加した上で、プレイスメントグループを再起動することが必要。
既存のプレイスメントグループに新規EC2インスタンスを追加する際は、インスタンスグループ全体を一旦停止してから、新規EC2インスタンスをグループに追加して、プレイスメントグループにあるEC2インスタンスを再起動することで解決することができる

## EC2フリート
EC2フリートはスポットインスタンスとオンデマンドインスタンスを組み合わせて定義ができるもの
## スポットフリート
スポットフリートはスポットインスタンスしか定義ができないフリートの集まり（オプションでオンデマンドインスタンスもできる）

## EC2の古いwindowsアップデート方式
### インプレースアップグレード
オペレーティングシステムファイルをアップグレードし、個人の設定およびファイルは維持される
### 並行アップグレード
設定、構成、データを取り込み、この情報を新しい Amazon EC2 インスタンス上のより新しいバージョンのオペレーティングシステムに移行する方法

## Elastic Network Adapter (ENA) 
サポート対象のインスタンスタイプに対して`最大100Gbps`のネットワーク速度をサポートすることができる

# EBS
## 暗号化
Amazon EBS 暗号化 は、EBS リソースのために、独自のキー管理インフラストラクチャの構築、保守、および保護を必要としない、簡単な暗号化ソリューションを提供します。EBSデータは既存の暗号化機能を有効化することで、データを暗号化することができます
暗号化されたボリュームやスナップショットの作成時に AWS Key Management Service (AWS KMS) カスタマーマスターキー (CMK) を使用

デフォルトで暗号化する場合はリージョンごとの設定でデフォルト化可能（個々のEBSの単位で無効にするとかは無理）

## Amazon Data Lifecycle Manager(DLM)
Amazon EBS ボリュームをバックアップするスナップショットの作成、保持、削除を自動化できます。

# ECS
## EC2を使用する場合のAuto Scaling 
ECS Cluster Auto Scalingを有効にするには、Capacity Providerと呼ばれる新たな項目を設定する必要があります。
1つのCapacity Providerは1つのEC2 Auto Scalingグループに関連付けられます。
あるAuto ScalingグループにECS Capacity Providerを関連付けてから、ECSクラスターにCapacity Providerを追加すると、クラスターを自動スケールできるようになります。

# ELB
## スティッキーセッション
同じ利用者からのリクエストを同じEC2インスタンスで処理するようにルーティングする（ステートフルなサービスで使う）
→ステートフルをステートレスにするためにセッション情報をElastiCacheなどsで管理するように改修した方が良い

急激にアクセスが増加する`スパイク`にはALB+EC2の構成ではスケールアウトに時間がかかるので対応できない。

## Evaluate Target Health
Route53のALBに対しての正常性のチェック
レイテンシーベースルーティングを使用している場合、Route 53 は、DNS クライアントまたはリゾルバーの場所からレイテンシーが最も低いレコードを返します。

# Elastic Beanstalk
## Elastic Beanstalk Tomcat Platform

## RDSはElastic Beanstalk環境に組み込まず、個別で立てた方が良い
RDSインスタンスはElastic Beanstalk環境の一部となると、パフォーマンスに最適ではないため、RDSを個別に作成して利用することが好ましい。データベースインスタンスのライフサイクルをアプリケーション環境のライフサイクルに結び付けるため、実稼働環境に理想的なものではない。

## 実行できるデプロイポリシー
### All at once
新しいバージョンをすべてのインスタンスに同時に展開します。 環境内のすべてのインスタンスは、展開が行われている間、短時間サービスが停止します。 これは、展開に必要な合計時間を最短にする方法です。

### Rolling(ローリング)
Elastic Beanstalk は環境の EC2 インスタンスを複数のバッチに分割し、アプリケーションの新しいバージョンを一度に 1 つのバッチにデプロイするため、環境内の残りのインスタンスは古いアプリケーションバージョンを実行した状態になります。つまりローリングデプロイ中は、アプリケーションの古いバージョンでリクエストを処理するインスタンスもあり、新しいバージョンでリクエストを処理するインスタンスも存在します。

### Rolling with additional batch
新しいバージョンをバッチで展開しますが、最初にインスタンスの新しいバッチを起動して、展開プロセス中に完全な容量を確保します。

### Immutable
変更不可能な更新を実行して、古いバージョンを起動しているインスタンスと並行しながら、別の Auto Scaling グループにあるアプリケーションの新しいバージョンを起動している新しいインスタンスのフルセットを起動します。Immutable デプロイは、部分的に完了したローリングデプロイにより発生する問題を防止できます。新しいインスタンスがヘルスチェックをパスしなかった場合、Elastic Beanstalkはそれを終了し、元のインスタンスをそのまま残します。



# Lambda
## LambdaとX-Ray
Lambdaの処理ステップのどこがボトルネックかを用意に判別できるようになる
## VPC Lambda
NATgatewayを使わないとインターネット接続できない。

## Lambda@Edge
※cloudfrontの機能
Lambda@Edgeとは、AWS Lambda の拡張機能で、CloudFront が配信するコンテンツをカスタマイズする関数を実行できるコンピューティングサービスで世界中のビューワーの最寄りのAWSのロケーションで実行することができる。
CloudFrontディストリビューションをLambda@Edge関数に関連付けると、CloudFront は、CloudFrontエッジロケーションでリクエストとレスポンスを傍受します。Lambda関数は、次のCloudFrontイベントの発生時に実行できる。

 - CloudFront がビューワーからリクエストを受信したとき (ビューワーリクエスト)
 - CloudFront がリクエストをオリジンに転送する前 (オリジンリクエスト)
 - CloudFront がオリジンからレスポンスを受信したとき (オリジンレスポンス)
 - CloudFront がビューワーにレスポンスを返す前 (ビューワーレスポンス)

# API gateway
## Lambdaオーソライザー
Lambda 関数を使用して API へのアクセスを制御する API Gateway の機能です。

Lambda オーソライザーは、OAuth や SAML などのベアラートークン認可戦略を使用する、または発信者 ID を判断するためにリクエストパラメータを使用するカスタム認証スキームを実装する場合に便利

https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html#api-gateway-lambda-authorizer-flow

## エラー
### INTEGRATION_FAILURE
Lambda関数とAPI Gatewayとの統合失敗を示す
### INTEGRATION_TIMEOUT
Lambdaファンクションが実行しない場合

## メトリクス
- 4XXError：指定された期間に取得されたクライアント側エラーの数。
- 5XXError：指定された期間に取得されたサーバー側エラーの数。
- CacheHitCount：指定された期間内に API キャッシュから配信されたリクエストの数。
- CacheMissCoun：API キャッシュが有効になっている特定の期間における、バックエンドから提供されたリクエストの数。
- Count：指定された期間内の API リクエストの合計数。
- IntegrationLatency：API Gateway がバックエンドにリクエストを中継してから、バックエンドからレスポンスを受け取るまでの時間。
- Latency：API Gateway がクライアントからリクエストを受け取ってから、クライアントにレスポンスを返すまでの時間。

## ステージ変数
API Gateway のデプロイステージでは、アルファ、ベータ、プロダクションなど、各 API 用の複数のリリースステージを管理できます。
ステージ変数を使用することで、異なるバックエンドのエンドポイントとやり取りするよう API デプロイステージを設定できます。
それによって、test.pintor.comエンドポイントとmain.pintor.testエンドポイントを介したテスト版リリースを使用して、本番リリースに接続するといった設定が可能

# SWF(Amazon Simple Workflow Service)
Amazon SWF は、開発者が並行したステップまたは連続したステップがあるバックグラウンドジョブを構築、実行、スケールするのに役立つ。Amazon SWF は、クラウド内の完全マネージド型の状態トラッカー、およびタスクコーディネーターとみなすことができる。

SWFでもSWFアクティビティの代わりにLambdaを実行することができる

例）動画の処理

# AWS Step Function
個々のLambdaをつなげるためのサービス

## モニタリング
人の作業によるアクティブティはCloudTrailで監視する。
システム状況のモニタリングはCloudWatchを使用する。

## SWF・Step Function使い分け
AWS Step Functions では、AWS の複数のサービスをサーバーレスのワークフローに整理できるため、すばやくアプリケーションをビルドおよび更新できます。これを利用することでSWFよりも視覚的に容易にワークフローを作成できるため、通常のワークフロー作成ではAWS Step Functionsの利用が推奨されている。
プロセスにおいて介入する外部信号が必要な場合、または結果を親に返す子プロセスを起動する場合は、AWS Step Functions では対応できないため、Amazon SWF使用することが求められている。

# App Sync
AppSyncはAWSの管理系GraphQLサービスにて、ApolloやPrismaと比べてAWSからインフラやサーバーまで提供してくれるサービス
デバイス間でアプリケーションデータを同期するためのサービス

# その他の知識
## RTO（目標復旧時間）
RTOは、インシデントが発生してから通常業務をオンラインに戻すまで「ダウンを許容できる最大時間」を指す。
## RPO(目標復旧時点)
RPOとは、インシデント後に通常運営を再開するために「復旧しなければならないバックアップファイルの古さ」を示す。
例）
2時にサーバーが停止してしまった場合にRPOが15分だと1時45分までのデータは復旧しないといけない
1時45分から2時までの間のデータは失われる。
