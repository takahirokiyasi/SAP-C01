# ENI (Elastic Network Interface)
IPアドレス・MACアドレス・セキュリティグループなどの属性を保持できる
## ENI プール

## ENIでEC2に複数のSSL証明書を処理
1つのEC2インスタンスに複数のENI（Elastic Network Interface）を接続することで対応ができます。ENIは、仮想ネットワークカードを表すVPCの論理ネットワークコンポーネントであり、このシナリオでは、2つのENIをオンデマンドEC2インスタンスに接続して、2つのSSLを処理できるようにすること

# インターリージョンVPCピアリング
Gateway、VPNコネクション、ネットワークアプライアンスなどを使う事なく、  
別のリージョンで稼働しているEC2インスタンス、RDSデータベース、LambdaファンクションなどのVPCリソースに対してPrivate IPアドレスにて通信が可能

# VPN
# SSL-VPN
既存のVPCのパブリックサブネットにSSL-VPNサーバーを構築する。既存のシステムをプライベートサブネットに配置することによってSSL-VPNサーバーを介して外部インターネットから利用することができる。
SSLを利用してセッション層で実装されるVPN

# IPsec-VPN
ネットワーク層で実装されるVPN
リモートアクセスにも活用できるが、ユーザー認証方法・NAPTの仕様・接続先情報の取得方法などに問題があり、実用的ではない。

SSL-VPNなら外部からのリモートアクセス、IPSec VPNなら組織間アクセスという利用方法の違いがある。

- Site-to-Site VPN 接続は、AWS Classic VPN または AWS VPN のいずれかです。
- IPSecトンネル経由で送信されるデータの整合性を保持する。
- IPSecトンネルを経由して送信されるデータは暗号化される。
- IPSecはインターネット経由で送信中のデータを保護する。
- IPSecトンネルのセットアップ中にIDが認証される。
- VPNゲートウェイ（VPG）とカスタマーゲートウェイ（CGW）の間にIPSecトンネルが確立される。

## VPNの可用性を高める
新しく別のカスタマーゲートウェイを導入して、別のデュアルトンネルVPN接続を追加でもう１つ設定します。AWS でデバイス障害が発生した場合、VPN 接続は自動的に 2 番目のトンネルにフェールオーバーして、アクセスが中断されないようにする。

## AWS Site-to-Site VPN
デフォルトでは、Amazon VPC内に起動されるインスタンスと顧客独自の (リモート) ネットワークとの通信はできない。VPCからリモートネットワークへのアクセスを有効にするには、AWS Site-to-Site VPN (Site-to-Site VPN) 接続を作成し、接続を経由してトラフィックを渡すようにルーティングを設定する。
IPsec VPNをサポート

### AWS CloudHub
複数のAWS Site-to-Site VPN接続がある場合にvpcとリモートネットワーク間（オンプレ）の通信だけでなくリモート間の通信を可能にする
がTransit Gatewayで複数のVPN接続を管理可能なのでTransit Gateway推奨

# Direct Connect
オンプレミスから AWS への専用ネットワーク接続の構築するもの。
標準のイーサネット光ファイバケーブルを介して接続するサービス
間にAWS Direct Connect ロケーションと言う
AWS とデータセンター、オフィス、またはコロケーション環境との間にプライベート接続を確立することができます。これにより、多くの場合、ネットワークのコストを削減し、帯域幅のスループットを向上させ、インターネットベースの接続よりも安定した接続をすることができる。

VPCからオンプレミス環境へ疎通するためにはVPCのルートテーブルに、オンプレミス環境側のネットワークへのルート情報が登録されている必要がある。
仮装インターフェイスを稼働状態にするために、802.1 Q VLANに対してVLANトランキングの有効化が必要
VPCのVGW(virtual private gateway)に対して、ルートプロパゲーションを有効化する。

## Direct Connect Gateway
単一のプライベート仮想インターフェイスを用いたプライベート接続で中国を除く全リージョンのVPCと閉域で接続することができる。
※同一VPCアカウントのVPCのみに接続可能
VPCからVPC・オンプレミスからオンプレミスへの折り返し接続は不可
Transit Gatewayにつなぐことも可能

Direct Connect Gatewayで複数のDirect Connect LocationからVGWの間に噛ませてVPCへ接続することができるので可用性が上がる。

仮想インターフェース(以下VIF)とVPCの仮想プライベートゲートウェイ(以下VGW)の間に追加する新たなコンポーネントで複数リージョンに対してDirect Connectできる
- Direct Connect GatewayをいずれかのAWSリージョンに作成すると、AWSの全リージョンに複製され、相互接続できる
- Direct Connect Gatewayには複数のVIFおよびVGWが接続できる

`※時間あたりの料金が必要なので料金が高い`  
direct connectを一つのリージョンにしてリージョン間VPCピアリングした場合の方が通信量に対して料金がかかるだけなので安い。

Direct Connect と VPNは同じVGWを使用することができる。

https://dev.classmethod.jp/articles/direct-connect-gateway/

## VIF（仮想インターフェイス）
AWS Direct Connect 接続の使用を開始するには、次のいずれかの仮想インターフェイスを作成する必要があります。
プライベートインターフェイスとパブリックインターフェイスは混在可能

### プライベート仮想インターフェイス
プライベート IP アドレスを使って Amazon VPCにアクセスするには、プライベート仮想インターフェイスを使用する必要があります。
一応全リージョンと接続もできる。

privateLink を併用してオンプレと閉域でAWSと接続することが可能

### パブリック仮想インターフェイス
パブリック仮想インターフェイスは、パブリック IP アドレスを使用してすべての AWS パブリックサービスにアクセスできます。（`VGWとつなげないので基本的にVPCにアクセス不可`下のVPNは例外）
パブリック仮想インターフェイスを利用することで、Direct Connectは、`VPC上で作成したサブネットとの通信だけでなく、S3やDynamoDB`といった従来インターネット経由でアクセスしていたAWSクラウド上のサービスも、Direct Connectの専用線を経由して直接通信することができます。
それにより、従来インターネット経由でアクセスしていたAWSクラウド上のサービスや、VPCを経由していたサービスも、より信頼性の高い直接的な接続が可能になります。

また、パブリック仮想インターフェイスによるDirect Connect 接続で VPC にVPN 接続を確立することができます。これはインターネット経由の VPC よりも速くて安全です。
Direct Connect  接続の AWS VPN 接続では、一貫性のあるスループットレベルを確保し、データを保護する暗号化アルゴリズムを実現します

### トランジット仮想インターフェイス
Direct Connect ゲートウェイに関連付けられた 1 つまたは複数の Amazon VPC トランジットゲートウェイ にアクセスするには、トランジット仮想インターフェイスを使用する必要があります。

### クロスアカウント
Connectionを所有しているAWSアカウントから他のAWSアカウントに対してVIFを提供することが可能

## LAG (Link Aggregation Group)
専用線を論理的に集約して１０GBしか無理なところを4本束ねて４０GB可能にしたりする

# VGW(仮想プライベートゲートウェイ)
`プライベート仮想インターフェイスを介して`、AWS Direct Connect 接続を、同じリージョンまたは異なるリージョンに配置されたアカウントの1つ以上のVPCに接続できる。
Virtual Interface のVPC側の終端
VPNの時にも必要
１０VPNまで（上限緩和可能）
トランジットゲートウェイがあるときはいらない

# CGW（カスタマーゲートウェイ）
VPCとオンプレミス環境間でVPN接続を確立する際に必要になる。

オンプレ側のルーターのパブリックIPが設定値として必要（VPNにおいてのオンプレ側の終点の設定）

# Transit Gateway
VPC間をつなぐサービス、VPNコネクションとつなげることでオンプレともつなげるし、DirectConnectともつなぐことができる。
※Direct　Connectとつなぐ場合の仮想インターフェイスはパブリックとかプライベート仮想インターフェイスではなくてTransit仮想インターフェイスでないといけない。
それぞれのVPC間でのネットワーク設定とかしなくてTransit Gatewayに全て集約することができる。
サブネットにENIをアタッチしてそれを介して通信を行う。（ENI用のサブネットを作成するのがおすすめ）
VPC間VPN間DirectConnect間を多拠点接続をフルマネージドで行える

VPC間のEC2で通信とかできる（制限する時はNACLとかサブネットでIP制限とかすれば良いし・もちろんTransit Gateway内のルートテーブルでも制限できる）
一つのVPCだけインターネットGatewayがアタッチされNATgatewayがあってprivate SubnetにENIをアタッチしといて他のVPCからTransit Gateway経由でそのVPCからインターネットへOutboundトラフィックをとかもできる（Outbound VPCの構成）

AWS Transit Gateway を利用して、多数のVPCを管理することができます。AWS Transit Gateway を使用すれば、中央のゲートウェイからネットワーク上にある Amazon VPC、オンプレミスのデータセンター、リモートオフィスそれぞれに単一の接続を構築して管理するのみでよいのです。Transit Gateway がハブの役割を果たし、トラフィックがスポークのように接続されたネットワーク間をどのようにルーティングするか等をすべて制御します。

AWS Transit Gateway では統計とログが提供されます。これらは、Amazon CloudWatch や Amazon VPC フローログなどのサービスで使用されます。Amazon CloudWatch を使用して、Amazon VPC と VPN 接続間の帯域幅の使用量、パケットフロー数、パケットドロップ数を取得できます。また、AWS Transit Gateway で Amazon VPC フローログを有効にできるため、AWS Transit Gateway を使用してルーティングされた IP トラフィックに関する情報を取得できます

また、トランジットゲートウェイをファイアウォールまたは IPS（侵入防止システム）に接続したり、ネットワークのすべての入出力トラフィックを処理する単一の VPC を作成することもできます。

## Transit Gateway network manager
AWS Transit Gateway network manager は、ネットワークトポロジーの変更、ルーティングの更新、接続ステータスの更新に関する組み込みのイベント通知を提供します。

## Transit Gatewayを使わなくて良いケース
料金が高いのでVPC間通信とDirect ConnectとVPC間接続だけだったら
VPCピアリング＋Direct Connect Gatewayで賄える

# VPC
リージョンあたりのVPCの数の制限が５
## IPアドレス枯渇
最大4つのセカンダリーCIDRブロックを関連付けてVPCに追加することにより、ネットワークをさらに拡張することができる。

## DHCP オプション
一度DHCPオプションのセットを作成すると、それらを変更できないため、DHCPオプションの新しいセットを作成し、VPCに関連付ける必要がある。
新しいDHCPオプションを作成して、 domain-name-servers=AmazonProvidedDNSを指定してVPCに関連付けを実施することで、エラーを回避することができる。  
[VPCのDNSについてAmazonProvidedDNS・DNS Resolution・DNS Hostname・DHCP Options Sets](https://blog.serverworks.co.jp/tech/2017/04/03/vpc-dns-matome/)

## VPCフローログ
ネットワークトラフィックをキャプチャしCloudWatchLogsへPublishする機能
ネットワークインターフェイスを送信元・送信先とするトラフィックが対象
セキュリティグループとネットワークACLのルールでAccept／Rejectされたトラフィックログを取得
追加料金はなしでCloudWatchLogsの標準料金かかる

## VPC トラフィック　ミラーリング
フローログと違いパケット内容まで取得できる機能
EC2にログインせずに任意のENIやNLBにバケットをコピーできる

脅威検出・コンテンツモニタリング・問題判別に使用する
Nitroシステムでサポートされているインスタンスのみ（A1　C5　M5　T3とか）

# VPC ピアリング
異なるVPC同士で利用しているCIDRレンジが重複すると接続を確立できない。両方とも10.0.0.0/16の時など
異なるリージョンでも可能（リージョン間VPCピアリングと呼ばれる）
別アカウントのVPC間でも可能

## 推移的なピアリング接続をサポートしない
AとB間・BとC間がピアリングされている場合、AからBを経由してCにアクセスする通信はVPCピアリングではできない
A・C間でVPCピアリング（フルメッシュ設定）するかTransit VPCかTransit gatewayを使う（Transit　gatewayの方が管理が楽で、多機能）

# Egress Only インターネットゲートウェイ
送信専用のインターネットゲートウェイ
IPv6アドレスはグローバルに一意であるため、デフォルトではパブリックアドレスになっている。
インスタンスがインターネットにアクセスできるようにしたいが、インターネット上のリソースがインスタンスとの通信をしたくない場合は、Egress-Only インターネットゲートウェイを使用できる。

# ELB
ELBへの負荷が増えてELBがスケールする場合、NLB以外のALBやCLBはIPアドレスが変化するため、ELBへのアクセスはDNS名じゃないとだめ
NLBはセキュリティグループを関連付けられないがALBとCLBは可能
ロードバランサーの可用性を高めるためには2つ以上のAZからサブネットを指定する必要がある

ICMP Echo Request/Replyを許可すればpingにも対応できる
## ALB
HTTP HTTPS HTTP/2
L7のコンテキストロードバランサー
WebSocketに対応
ALBのみWAFと連携可能（アクセス制限、SQLインジェクションからの保護等）

## NLB
TCP　UDP　SSL／TLS
L4機能を提供するロードバランサー
高スループット（1 秒間に数百万件ものリクエストを分散可）、低レイテンシ。
WebSocketに対応
`WAFは使えない`

Internet-facing Internal共にIPアドレスが固定（ALB、CLBは不定）
AZ毎に１つのIPアドレスを利用、DNSはAレコードでも設定可能
作成時に自動割り当てされたIPアドレスか自分が持ってるElastic　IPが指定できる
NLBに対するセキュリティグループの設定がない

送信元 IP アドレスの保持。クライアント側の送信元 IP が保持されるため、この情報をアプリケーションで使用して、他の処理を実行できる。（他のELBは通信の終端になっちゃってるのでターゲット側のアクセスログにはALB／CLBのIPアドレスが記録されてしまう）
DSR（帰りは直接クライアントと通信）ではなく行き帰りの通信もNLBを通っている

TargetのセキュリティグループでクライアントIPの接続を許可する
（VPC内からのアクセスでもターゲットへのアクセス許可はセキュリティグループのIDの指定ではなくクライアントIPの指定が必要）

## CLB
HTTP　HTTPS　TCP
以前の世代のロードバランサーだが特殊な場合のみ使用
EC2-Classicのサポート
アプリケーション生成のクッキーを使用したスティッキーセッションのサポート
カスタムセキュリティポリシー
TCP及びSSLリスナーのサポート

## メトリクス
### HealthyHostCount
正常なバックエンドのホスト数
### UnHealthyHostCount
異常なバックエンドのホスト数
Average及びMinmiumの統計情報を利用するのが有用
### RequestCount
### Latency
### SurgeQueueLength
SurgeQueueLengthメトリクスは、正常なインスタンスへのルーティングを保留中のリクエスト (HTTP リスナー) または接続 (TCP リスナー) の合計数を提供してくれます。これによって、保留中のリクエスト総数を把握することで、着信トラフィックの状況を確認することができます。
### SpilloverCount
SpilloverCountはサージキューがいっぱいなため、拒否されたリクエストの総数を返します。これは着信トラフィックが急増した際に拒否数を把握する際に利用します。

###  アクセスログ
最短5分間隔でELBのアクセスログをS3に出力可能

ALB・CLB使ってる場合はTCPの処理がALBで終端しているため、ターゲット側のアクセスログにはALB／CLBのIPアドレスが記録されてしまう
そのため対策としてX-Forwarded-Forヘッダーを使用する必要がある。（元のクライアンどIPアドレスの情報を付加するやつ）

### コネクションタイムアウト
無通信状態が続くとそのコネクションを自動で切断する
ALB・CLBはデフォルト６０秒
NLBは３５０秒（固定）

### Connection Draining (登録解除の遅延)
バックエンドのEC2インスタンスがELBから登録解除したり、ヘルスチェックが失敗した時に、いきなり通信を止めるのではなく
新規リクエストの割り振りは中止して、処理中のリクエストが終わるまでは一定期間待つ設定
デフォルトで有効　タイムアウト300秒
ヘルスステータスはdrainingと表示される

### スティッキーセッション
同じユーザーからきたリクエストを全て同じEC2インスタンスに送信する（そもそも使うな）
ALB・CLBで使用可能
HTTP／HTTPSでのみ
デフォルトで無効

通常はロードバランサーが生成したクッキーを使用してスティキーセッションを行う（有効期限を指定してELBで制御・無期限も可能）
CLBのみアプリケーション生成のクッキーを使用することが可能

## SSL/TSL Termination
ELB側でSSL/TLS認証ができる。
通信パターンは３つ
1. ELBでSSL TerminationしバックエンドとはSSLなし　HTTPS HTTP
1. ELBでSSL Terminationし、バックエンドとは別のSSL HTTPS HTTPS
1. SSLをバイパスしてバックエンドにTCPで送信 TCP TCP
    クライアント証明書を使う場合はこれ

### 事前定義されたセキュリティポリシー
SSL/TSLの利用時には事前定義されたセキュリティポリシーを利用する
TLS1.0 v1.1 v1.2をサポート
CLBのみセキュリティポリシーのカスタマイズができる（ガラケーとか特殊な暗号化が使えない場合とか利用する）
PFSのサポート

ELBSecurityPolicy-2016-08がデフォルト

### サーバー証明書
ACMを使えば、証明書の設定が数クリックで完了　証明書は自動更新

ドメイン認証タイプの証明書（DV）なのでより上位の証明書（実在証明書　OV,　実在証明拡張型　EV）を利用する場合はサードパーティの証明書を取得してACMにインポートして利用

### SNIでの複数TLS証明書のスマートセレクション
複数のTLS証明書を１つのALB／NLBのListenerに設定可能（CLBは無理）
SNIをサポートするクライアントには適切な証明書を選択してTLS通信できる
SNIがサポートされていないクライアントはデフォルト証明書が使われる

ALB毎に最大25証明書（ACMとIAM全ての証明書が利用可能）

## Proxy Protocol
Proxy Protocol は、接続をリクエストする送信元から、接続がリクエストされる送信先に接続情報を伝達するために使用されるインターネットプロトコルです。
ELBでは Proxy Protocol のバージョン 1 を使用します。このバージョンでは、人が読んで理解できるヘッダー形式が使われます。
Proxy Protocolヘッダーは、バックエンド接続にTCPを使用するロードバランサーがある場合に、クライアントのIPアドレスを識別するのに役立ちます。
ロードバランサーはクライアントとインスタンス間のトラフィックをインターセプトするため、インスタンスからのアクセスログには、発信元クライアントではなくロードバランサーのIPアドレスが含まれます。
リクエストの最初の行を解析して、クライアントのIPアドレスとポート番号を取得できます。

## リスナー
ロードバランサーがListenするプロトコルとポート番号とロードバランサーからターゲットへの接続用のプロトコルとポート番号を設定

## ターゲット
トラフィックを転送するEC2インスタンスなどのリソースやエンドポイントのこと
IPアドレスでターゲットを指定可能（CLB以外）※自社のオンプレのサーバーに分散する場合とか　DirectConnect使用
Lambda関数を指定（ALBのみ）
インスタンスIDでターゲットを指定（大体これ）

ECSの場合は動的ポートマッピングでECSの各タスクは自動でターゲットグループに登録され、自動で負荷分散される。

ターゲットグループはターゲットの集合。ターゲットグループ内で負荷分散（ALB）

## ルール
リクエストがどのように転送されるか設定できる（ALBのみ）
複数ルールを設定可能で上から設定可能
- パスベースのルーティング
- `ホストベースのルーティング`（HTTPヘッダーのHostフィールド　一つのELBでドメインに応じて振り分け可能）
- HTTPヘッダーベースのルーティング
- クエリ文字列のルーティング　バージョンでサーバーを分けたりとか
- 送信元IPでのルーティング

### ユーザー認証機能
ルールで認証を挟むことができる
Cognitoによる認証
OIDC　IdPによる認証（OpenID Connect）
認証画面にリダイレクトされる

## ELBにカスタムドメイン（独自ドメイン）を利用する場合
Route53を使用する場合はRoute53エイリアスコードで登録　CNAMEでの登録も可能（Route53以外のDNSの場合はCNAMEで登録）
Zone Apex（www.exapmple.comではなくexample.comのようなサブドメインを含まないドメイン）の場合通常のDNSサーバーではCNAME不可　Route53のエイリアスレコードを使うことで設定可能（CNAMEだとZone Apexは設定不可）

## クロスゾーン負荷分散
NLBだけデフォルト無効　ALB　CLBはデフォルトで有効
AZ間でEC2などのリソースの数が不均衡でもAZに対して均等な負荷をかけてしまう場合に、リソースが少ないAZの負荷が高くなってしまうが
クロスゾーン負荷分散が有効であればAZごとのEC2インスタンス数が異なってもクロスゾーン負荷分散により全ての負荷を均等にできる。

クライアントが DNS ルックアップをキャッシュする環境では、着信リクエストがいずれかのアベイラビリティーゾーンを優先する場合がある。そのためクロスゾーン負荷分散を有効にする必要がある。

## 同一のインスタンスで複数ポートへの負荷分散
ALB NLBではEC2インスタンスで、複数ポートを開放して使っている場合にその複数ポートに対して負荷分散が可能
一つのインスタンスに複数のDockerコンテナの場合とか

## 自動スケーリングの注意点
ELCは負荷に応じて自動でスケーリングするが
ALB・CLBにおいては接続・リクエストが瞬間的に急増した場合にELBのスケーリングが間に合わない時にHTTP５０３を返す
対策としてpre-warming(暖気運転)の申請を行うか、自前で負荷を段階的にかけてスケールさせておく必要あり
NLBは突発的なリクエストでも処理可能

# AWS Global Accelerator
ALB NLBが対応
ユーザーが近いエッジリージョンからGlobal Networkを経由して最も近いリージョンにアクセス可能
ユーザーは固定IPでアクセス可能（２つ設定可能）

## Accelerated サイト間 VPN
AWS Global Accelerator は、AWS グローバルネットワークと AWS エッジロケーションを介してトラフィックをインテリジェントにルーティングすることにより、VPN 接続のパフォーマンスを向上させる Accelerated サイト間 VPNを実現します。
これはAcceleration を有効にして、AWS グローバルネットワークを使用してパフォーマンスを向上させられるものであり、オフィスとAWSでのVPN接続そのもののパフォーマンス改善には適していません。

# Route 53
## ホストゾーン（Route53 Hosted Zone）
ホストゾーンはレコードのコンテナであり、レコードには example.com やそのサブドメイン (acme.example.com や zenith.example.com) の特定のドメインのトラフィックをどのようにルーティングするかに関する情報を保持

ホスト名 www1
FQDN(完全修飾ドメイン名)　www1.sub.example.com. 一意に識別可能
### パブリックホストゾーン
パブリックホストゾーンはインターネット上に公開されたDNSにメインレコードを管理するコンテナです。また、インターネットのDNSドメインに対するトラフィックのルーティング方法を定義するものです。
### プライベートホストゾーン
プライベートホストゾーンはVPCに閉じたプライベートネットワーク内のドメインのレコードを管理するコンテナ

DNS用のVPCを作成してVPCピアリングで他のVPCをつなげた上でプライベートホストゾーンで他のVPCにルーティングする要件などもある。
#### 設定方法
プライベートホストゾーンを使用するには、次の Amazon VPC 設定を `true` に設定する必要があります。
enableDnsHostnames
enableDnsSupport

### フェイルオーバーの設定
Evaluate Target Healthをオンにする
ALBのヘルスチェックで異常を示せるようにする
#### アクティブ/パッシブ
Route 53 はプライマリリソースをアクティブに返します。エラーが発生すると、Route 53 はバックアップリソースを返します。フェイルオーバーポリシーを使用して設定されます。 
プライマリリソースまたはリソースグループをほとんどの時間で利用可能にして、すべてのプライマリリソースが使用できなくなった場合に備えて、セカンダリリソースまたはリソースグループをスタンバイ状態にする場合は、フェイルオーバー (アクティブ/パッシブ) 設定を使用します。
クエリへの応答で Route 53 が返すのは、正常なプライマリリソースのみです。すべてのプライマリリソースで異常が発生した場合、Route 53 は、DNS クエリへの応答として、正常なセカンダリリソースのみを返します。

#### アクティブ/アクティブ
Route 53 は複数のリソースをアクティブに返します。エラーが発生すると、Route 53 は正常なリソースに戻します。フェイルオーバー以外のルーティングポリシーを使用して設定されます。 
フェイルオーバー (アクティブ/アクティブ)はすべてのリソースをほとんどの時間で利用できるようにするに使用します。リソースが利用できなくなると、そのリソースを Route 53 が異常として検出し、以後、クエリへの応答に含めることを控えます。
すべてのリソースをほとんどの時間で利用できるようにするに使用します。リソースが利用できなくなると、そのリソースを Route 53 が異常として検出し、以後、クエリへの応答に含めることを控えます。

#### 組み合わせ
複数のルーティングポリシー (例: レイテンシーベース、加重) は、複雑 DNS フェイルオーバーを設定するためにツリーに組み合わされています。 

## ルーティング
### 複数値回答ルーティング
複数値回答ルーティングを使用すると、DNSクエリに応答して、WebサーバーのIPアドレスなどの複数の値を返すようにAmazon Route 53を構成できます。 ほとんどすべてのレコードに複数の値を指定できますが、複数値の回答ルーティングでは各リソースの正常性も確認できるため、Route 53は正常なリソースの値のみを返します。 ロードバランサーの代わりにはなりませんが、複数のヘルスチェック可能なIPアドレスを返す機能は、DNSを使用して可用性とロードバランシングを改善する方法です。 
複数値回答ルーティングはロードバランサーの代替ではありませんが、複数のヘルスチェック可能なIPアドレスを返す機能により、システムの可用性とロードバランシングが改善されます。複数値回答ルーティングを設定する際はALIASレコードに「NO」と設定することが必要です。

## Route53 Resolver for Hybrid Clouds
オンプレミス-VPCの相互名前解決が簡単に実現
今まではオンプレミスからVPC内の名前解決がめんどくさかった（SimpleADのDNS機能を使ったりしてた）

# CloudFront
全てのTTLを0に設定することで、コンテンツは変更されるとすぐにオリジンから配信することができる。

オリジンにIPを指定することはできない。Amazon S3バケットまたは HTTP サーバーのDNSドメイン名のみ

## 署名つきURL・Cookie
URLとCookieではほとんど同じ機能を提供している。
複数ファイル制限する場合はCookie
### 署名付きURL
URLを利用してファイルをアップロード・ダウンロードを行うことが可能
URLを発行するには以下のどれかの認証情報（署名者）が必要
- IAMのインスタンスプロファイル（EC2とかのIAMRoleを納めるための容器）ほぼIAM Roleと言っても良いかも　6時間有効
- STS 36時間有効
- IAMユーザー　最大7日有効
ユーザーが削除された時は期限前に失効する。

アップロードが遅い場合はAPIGateway（エッジ最適化APIエンドポイント）＋Cognitoを使用して代用できる

## 地域制限 (地理的ブロッキング) 
地域制限 (地理的ブロッキング) を使用すると、CloudFront ウェブディストリビューションを通じて配信しているコンテンツについて、特定地域のユーザーによるアクセスを回避できる。

## Origin Protocol Policy
カスタムオリジンと通信するプロトコルを決めるオプション
- Http Only
- Https Only
- Mathc

## Viewer Protocol Policy
ビューワーと通信するプロトコルを決めるオプション
- http redirect https
- http and https
- https only

## デフォルト証明書
デフォルトでは、URLでCloudFront配信ドメイン名を使用して、HTTPS経由で視聴者にコンテンツを配信できます。独自のドメインによる配信設定ができません。

## API アクセラレーション
キャッシュを使わないRestAPIとかでも他のCDNサービスよりも速くなるらしい

## クォータ
リクエストの制限など機能制限のこと
引き上げすることも可能

# port について
リクエストを開始するクライアントは、一時ポートの範囲を選択します。範囲は、クライアントのオペレーティングシステムによって変わります。 

- 多くの Linux カーネル (Amazon Linux カーネルを含む) は、ポート 32768〜61000 を使用します。
- Elastic Load Balancing が送信元のリクエストは、ポート 1024〜65535 を使用します。
- Windows Server 2003 を介する Windows オペレーティングシステムは、ポート 1025〜5000 を使用します。
- Windows Server 2008 以降のバージョンでは、ポート 49152〜65535 を使用します。
- NAT ゲートウェイはポート 1024〜65535 を使用します.
- AWS Lambda 関数は、ポート 1024-65535 を使用します。

# NAT ゲートウェイ
ネットワークアドレス変換 (NAT) ゲートウェイを使用して、プライベートサブネットのインスタンスからはインターネットや他のAWSのサービスに接続できるが、インターネットからはこれらのインスタンスとの接続を開始できないようにすることができます。
AZごとに設置するのがベストプラクティス

# VPCエンドポイント
## Gateway型
S3とDynamoDBのみ
サブネットに特殊なルーティング設定をし、VPC内部から直接サービスと通信する
通信先のIPアドレスはグローバルIPアドレス
アクセス制御はS3ではバケットポリシーで
料金は無料
## interface型（Private link）
サブネットにエンドポイント用のプライベートIPアドレスが生成される。
VPC内部のDNSがエンドポイント向けの名前解決に対してプライベートIPアドレスで回答する
セキュリティグループでアクセス制御を行う
マルチAZで設定するようにして冗長性をユーザー側で担保する
オンプレミスにネイティブ対応
料金は有料

# VPCシェアリング
アカウントを跨いだVPCシェアリングによりVPCを削減できる
